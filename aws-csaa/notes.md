## EC2

### EC2 Instance Store
- Better I/O performance, ephemeral, good for buffer / cache / scratch data / temporary content
- Can reach over than 200k IOPS.

### EBS volume types:
- gp2 / gp3:  low latency apps, dev/test env
- io2Bloquer: sub millisec latency, high perf IOPS, over than 64k IOPS or 1 Go/s throughput
- io1 / io2: workloads with more than 16k IOPS, I/O intensive database workloads
- st1: big data, data warehouses, log processing
- sc1: throughput-oriented storage data that is infrequently accessed, lowest storage cost scenarios
- Multi-attach is only available with io1 io2

### Encrypted EBS volume
- data at rest is encrypted in the volume
- data in flight is encrypted
- all snapshots are encrypted
- all volumes created from the snapshot are encrypted
- To encrypt an EBS volume, create a snapshot and create an encrypted from this snapshot

### EBS RAID options
- RAID 0 => performance
  - if one disk fails, all data is failed
  - for example, if we have 2 500 GiB EBS io1 volumes with 4000 IOPS each => 1000 GiB RAID 0 array with 8000 IOPS
    bandwith and 1,000 MB/s throughput
- RAID 1 => fault-tolerance (mirroring a volume)
  - if one disk fails, our logical volume is still working
  - it uses 2x the network
  - for example, if we have 2 500 GiB EBS io1 volumes with 4000 IOPS each => 500 GiB RAID 1 array with 4000 IOPS
    bandwith and 500 MB/s throughput

### EFS - Elastic File System
- Managed NFS (Network File System) that can be mounted on many EC2
- EFS works with EC2 instances in multi-AZ
- Highly available, scalable, expensive (3x gp2), pay per use
- Use cases: content management, web serving, data sharing, Wordpress
- Only compatible with Linux based AMI (not Windows)
- Performance mode:
  - General purpose (default): latency-sensitive use cases (web server, CMS...)
  - Max I/O: higher latency and throughput, highly parallel (big data, media processing)
- Throughput mode:
  - Bursting (1 TB = 50 MiB/s + burst up to 100 MiB/s)
  - Provisioned: set your throughput regardless of storage (ex: very small fs but very high throuhput)
- Storage Tiers: lifecycle management feature, move file after N days
  - Standard: for frequent access
  - EFS-IA: Infrequent Access but lower price to store

### EBS vs EFS
- EBS
  - EBS volumes can be attached to only one instance at a time
  - are locked to the AZ level
  - gp2: IO increases if the disk size increases
  - io1: can increase IO independently
  - to migrate EBS volume across AZ -> take a snapshot -> restore it in another AZ
  - root EBS volumes of instances get terminated if instance gets terminated (by default)
- EFS
  - Mounting instances across AZ
  - EFS share website files
  - ONLY for Linux
  - EFS more expensive than EBS
  - Can leverage EFS-IA for cost savings
___

## High Availability and Scalability: ELB & ASG

### AWS has 3 kinds of managed Load Balancers
- Classic Load Balancer (v1): HTTP, HTTPS, TCP
- Application Load Balancer (v2): HTTP, HTTPS, WebSocket
- Network Load Balancer (v2): TCP, TLS (secure TCP), UDP

### Security groups
- Users <--SG1--> Load Balancer <--SG2--> EC2
- SG1 allows HTTP and HTTPS traffic from anywhere
- SG2 allows HTTP traffic only from SG1 (only from the Load Balancer)

### ALB: Application Load Balancer
- Layer 7, HTTP / HTTPS / Websockets
- Routing tables to diff target groups (based on path in URL, hostname or query strings)
- Great fit for microservices & container-based apps (Docker & Amazon ECS)
- Has a port mapping feature to redirect to dynamic port in ECS
- Has a fixed hostname => exposes a static DNS
- Does not see the IP of the client directly, true IP is in the X-Forwarded-For header
  (X-Forwarded-Port, X-Forwarded-Proto)

### NLB: Network Load Balancer
- Layer 4, forwards TCP & UDP traffic to instances
- Handle a million of requests per second
- Less latency ~ 100ms (vs 400ms for ALB)
- Exposes one static IP per AZ (helpful for whitelisting specific IP)

### Sticky sessions (session affinity):
- Same client is always redirected to the same instance behind the load balancer
- It works with a cookie that has an expiration date that we can control
  - Application-based cookies: custom (generated by the target) or application (generated by the LB)
  - Duration-based cookies: generated by the LB

### Cross-Zone LB
- Balance evenly across multiple AZ:
  Ex: 2 instances in AZ1, 8 instances AZ2
    - With cross-zone: Instances from AZ1 and AZ2 will receive 10% of traffic
    - Without: Instances of AZ1 will receive 25% and instances of AZ2 6,25%
- Application LB => enabled by default, no charges
- Network LB => disabled by default, not free
- Classic LB => enabled through console, disabled through CLI / API, no charges

### SSL / TLS
- Allows traffic between client and LB to be encrypted in transit (in-flight encryption)
- TLS is a newer version of SSL
- Public SSL certificates are issued by Certificate Authorities (Symantec, Letsencrypt...)
- SNI (Server Name Indication):
  - Solves the problem of loading multiple SSL certs onto one webserver (to serve multiple websites)
    Ex: A load balancer is hosting 2 target groups with hostnames api.com, yo.com. If we want to expose
    HTTPS traffic for both of these hostnames we should use SNI.
  - CLB supports only one SSL certificate, must use multiple CLB for multiple hostnames with multiple SSL certifs
  - ALB & NLB supports multiple listeners with multiple SSL certifs and use SNI to make it work

### Connection draining for CLB / De-registration Delay for ALB & NLB
- Time to complete "in-flight requests" while the instance is de-registering or unhealthy

### ASG (Auto Scaling Group)
- Scale out (add EC2 instances) to match an increased load up to the configured "maximum capacity"
- Scale in (remove EC2 instances) to match a decreased load
- Ensure we have a min and max number of machines running
- Scaling policies can be on CPU, Network and on custom metrics or based on a schedule
- ASGs use Launch configurations or Launch templates (newer)
- IAM roles attached to An ASG will get assigned to EC2 instances
- ASG are free
- If instances under ASG get terminated, the ASG will automatically create new ones as a replacement
- It's possible to setup ASG to get health status of instances thanks to an ALB and terminate unhealthy instances
- Default Termination Policy:
  1. Find the AZ which has most number of instances
  2. If there are multiple instances in the AZ, delete the one with the oldest launch conf
- Lifecycle Hooks:
  - By default, as soon as instance is launched in an ASG it's in service
  - Ability to perform extra steps before instance goes in service or do some actions before it's terminated

___

## AWS Fundamentals: RDS + Aurora + ElastiCache

### 